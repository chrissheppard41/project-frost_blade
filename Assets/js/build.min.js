function Squad(){var a=0,b=0,c=[];this.Group="";var d="",e="",f=0,g=0,h=[],i=[],j=!1;this.setId=function(b){a=b},this.getId=function(){return a},this.setSquadId=function(a){b=a},this.getSquadId=function(){return b},this.setArmyList=function(a){d=a},this.getArmyList=function(){return d},this.setUnits=function(a){c=a},this.getUnits=function(){return c},this.setName=function(a){e=a},this.getName=function(){return e},this.setArmour=function(a){j=a},this.getArmour=function(){return j},this.setPosition=function(a){f=a},this.getPosition=function(){return f},this.setGroup=function(a){this.Group=a},this.getGroup=function(){return this.Group},this.addTotal=function(a){g+=parseInt(a,0)},this.subTotal=function(a){g-=parseInt(a,0)},this.getTotal=function(){return g},this.setCharacteristics=function(a){h.push(a)},this.getCharacteristics=function(){return h},this.setWargears=function(a){i.push(a)},this.getWargears=function(){return i},this.buildCharacteristics=function(a){for(var b in a)-1==h.indexOf(a[b].name)&&this.setCharacteristics(a[b].name)},this.buildWargears=function(a){for(var b in a)-1==i.indexOf(a[b].name)&&this.setWargears(a[b].name)}}function Unit(a){this.id=parseInt(a.Units.id,0);var b={min_count:parseInt(a.min_count,0),max_count:parseInt(a.max_count,0),count:parseInt(a.min_count,0),pts:parseInt(a.pts,0),Groups:a.Groups,Equiped:[],Unit:{name:a.name,unittype:a.Units.unittype,weapon_skill:parseInt(a.Units.weapon_skill,0),ballistic_skill:parseInt(a.Units.ballistic_skill,0),strength:parseInt(a.Units.strength,0),toughness:parseInt(a.Units.toughness,0),wounds:parseInt(a.Units.wounds,0),attacks:parseInt(a.Units.attacks,0),initiative:parseInt(a.Units.initiative,0),leadership:parseInt(a.Units.leadership,0),armour_save:parseInt(a.Units.armour_save,0),invulnerable_save:parseInt(a.Units.invulnerable_save,0),front_armour:parseInt(a.Units.front_armour,0),side_armour:parseInt(a.Units.side_armour,0),rear_armour:parseInt(a.Units.rear_armour,0),hull_hitpoints:parseInt(a.Units.hull_hitpoints,0)}};this.getUnitAttr=function(a){return b.Unit[a]},this.setUnitAttr=function(a,c){b.Unit[a]=c},this.getAttr=function(a){return b[a]},this.setAttr=function(a,c){b[a]=c},this.setArrayAttr=function(a,c){b[a].push(c)},this.getAllAttr=function(){return b}}var myApp=angular.module("tool",["ngRoute","ngSanitize"]),Loader=function(){return{chatty:!1,sources:[],total:0,images:[],loaded:0,percent:0,element:0,scope:0,init:function(a){var b=document.styleSheets;if(this.element=a,!b.length)return this.chatty&&console.log("Loader: No document stylesheets found. Calling home..."),void this.end();var c,d,e,f,g,h,i,j,k=b.length;for(c=0;k>c;++c)if(i=b[c].rules||b[c].cssRules,i.length)for(this.chatty&&console.log("Loader: Parsing",b[c].href),e=i.length,d=0;e>d;++d)if(h=i[d].type,!h||1===h||4===h)if(4!==h)i[d].style&&this.addSource(i[d].style.backgroundImage);else for(j=i[d].cssRules,g=j.length,f=0;g>f;++f)1===j[f].type&&j[f].style&&this.addSource(j[f].style.backgroundImage);this.filterSources()},addSource:function(a){return a&&"initial"!=a&&"none"!=a?(this.sources[a]=1,!0):!1},end:function(){this.chatty&&console.log("Loader: Finished..."),this.element.attr("class","boom"),$(this.element).parent().parent().delay(500).fadeOut("slow",function(){this.remove()})},filterSources:function(){var a=!0,b=[];for(var c in this.sources)"url"===c.substr(0,3)&&(-1==c.indexOf(this.retinaDenominator)?b.push(c.slice(4,-1).replace(/["']/g,"")):a&&b.push(c.slice(4,-1).replace(/["']/g,"")));this.sources=b,b=null,this.total=this.sources.length,this.createImageLoaders()},createImageLoaders:function(){function a(){d.onImageComplete(this.src,!0)}function b(){d.onImageComplete(this.src,!1)}var c,d=this,e=this.sources.length;for(c=0;e>c;++c)this.sources[c].indexOf(")")>-1?this.total-=1:(this.images[c]=new Image,this.images[c].onload=a,this.images[c].onerror=b,this.images[c].src=this.sources[c])},onImageComplete:function(a,b){b&&(this.loaded++,this.percent=this.loaded==this.total?100:Math.ceil(this.loaded/this.total*100),this.chatty&&console.log("ImagePreloader: Current percent:",this.percent,"	Loaded ok:",b),this.onProgress&&this.onProgress(this.percent),this.loaded==this.total&&this.end())},onProgress:function(a){this.element.css({height:a+"%"})}}}(),SquadList=function(){var a=[],b=[],c=[];return{setSquad:function(b){a.push(b)},getSquad:function(){return a},submitSquad:function(){var d=[];for(var e in a){b=[];var f=a[e].getUnits();for(var g in f){c=[];var h=f[g].getAttr("Equiped");for(var i in h)c[i]={wargears_id:h[i].id};b[g]={units_id:f[g].id,count:f[g].getAttr("count"),ArmyWargears:c}}d[e]={squads_id:a[e].getSquadId(),armylists_id:a[e].getArmyList(),position:a[e].getPosition(),ArmyUnits:b}}return{ArmySquads:d}},getTotal:function(){var b=0;for(var c in a)b+=a[c].getTotal();return b},cleanSquad:function(){a=[]},orderSquads:function(){a.sort(function(a,b){return a.getPosition()<b.getPosition()?-1:a.getPosition()>b.getPosition()?1:0})},squadPositionsOnAction:function(b,c){for(var d=0;d<a.length;d++)a[d].getPosition()>=b&&a[d].setPosition(c?a[d].getPosition()+1:a[d].getPosition()-1)},squadPositionsOnSort:function(b,c,d){for(var e=b.split("_"),f=0;f<a.length;f++)d>c&&a[f].getPosition()>=c&&a[f].getPosition()<d&&a[f].setPosition(a[f].getPosition()+1),c>d&&a[f].getPosition()<=c&&a[f].getPosition()>d&&a[f].setPosition(a[f].getPosition()-1);a[e[1]].setPosition(c)},removeSquad:function(b,c){for(var d=0;d<a.length;d++)a[d].getId()===b&&a.splice(d,1);this.squadPositionsOnAction(c,!1)}}}();myApp.controller("AddCtrl",["$scope","$rootScope","$routeParams","$location","list","displayErrors",function(a,b,c,d,e,f){a.user_id=$sid,b.logged_in||(window.location.href="#/"),console.log("Add"),a.step_2_view=!0,a.step_3_view=!0,a.step_4_view=!0;var g=e.getAsync("GET","/armytypes.json",{});a.my_armies={},g.then(function(){a.Races=e.data}),a.dis_races=function(){a.armies=a.Races.Races[a.race].Armies,a.step_2_view=!1},a.dis_squads=function(){var b=e.getSecure("GET","/squads/"+a.army,{});a.squads={},b.then(function(b){a.squads=b.Squads,a.step_3_view=!1})},a.displayFormmessages=function(b){a.formMessage="",a.formMessage=e.outputError(b.errors)},a.add_resets=function(){a.add_army_list.$dirty=!1,a.add_army_list.$pristine=!0,a.army={},a.race={},a.races_id="",a.name="",a.descr="",a.points_limit="",a.hide="",a.users_id="",a.step_2_view=!0,a.step_3_view=!0,a.step_4_view=!0,a.sec_add_army=!1},a.submit_add=function(){if(a.add_army_list.$invalid)a.formMessage="Form contains errors";else{a.formMessage="",void 0===this.hide&&(this.hide=0);var b=e.getAsync("POST","/add/save.json",{ArmyLists:{armies_id:this.army,name:this.name,descr:this.descr,point_limit:this.points_limit,hide:this.hide}});b.then(function(b){200==b.code?(a.add_resets(),window.location.href="#/setup/"+b.data.id):a.formMessage=f.formErrors(b.errors)})}return!1}}]),myApp.controller("DisplayCtrl",["$scope","$http","list","$rootScope","$location","vote",function(a,b,c,d,e,f){var g=c.getAsync("GET","/armies_all.json",{});a.my_armies={},a.all_armies={},a.top_armies={},g.then(function(){0!==d.user_id&&(a.my_armies=c.data.private.ArmyLists,a.my_armies_count=c.data.private.count),a.all_armies=c.data.public.ArmyLists,a.all_armies_count=c.data.public.count,a.top_armies=c.data.top.ArmyLists}),a.votes=function(b,c){f.votingFront(a,b,c)},a.view=function(a){window.location.href="#/view/"+a},a.submit_delete=function(b){var e=c.getAsync("DELETE","/delete_army/"+b+".json",{});return e.then(function(){if(200==c.data.code){var b=c.getAsync("GET","/armies_all.json",{});a.my_armies={},a.all_armies={},a.top_armies={},b.then(function(){0!==d.user_id&&(a.my_armies=c.data.private.ArmyLists,a.my_armies_count=c.data.private.count),a.all_armies=c.data.public.ArmyLists,a.all_armies_count=c.data.public.count,a.top_armies=c.data.top.ArmyLists})}}),!1}}]),myApp.controller("EditCtrl",["$scope","$rootScope","$routeParams","$location","list",function(a,b,c,d,e){a.user_id=$sid,b.logged_in||(window.location.href="#/"),a.routeParams=c,console.log("Edit",a.routeParams.id);var f=e.getAsync("GET","/view_army/"+a.routeParams.id+".json",{});f.then(function(){a.name=e.data.ArmyLists.name,a.descr=e.data.ArmyLists.descr,a.points_limit=parseInt(e.data.ArmyLists.point_limit,0),a.hide=e.data.ArmyLists.hide}),a.submit_edit=function(){if(a.edit_army_list.$invalid)a.formMessage="Form contains errors";else{a.formMessage="";var b=e.getAsync("POST","/edit/save/"+a.routeParams.id+".json",{name:this.name,descr:this.descr,point_limit:this.points_limit,hide:this.hide});b.then(function(){200==e.data.code?d.path("#/"):a.displayFormmessages(e)})}return!1}}]),myApp.controller("ListCtrl",["$scope","$rootScope","$routeParams","list","vote",function(a,b,c,d,e){a.user_id=$sid,a.routeParams=c,console.log("List",a.routeParams.id);var f="armies_public";window.location.href.indexOf("my_lists")>-1&&(b.logged_in||(window.location.href="#/"),f="armies_personal");var g=d.getAsync("GET","/"+f+".json",{});a.public_armies=[],a.armies=[],a.currentPage=0,a.numPerPage=10,a.maxSize=5,a.pagecount=0,g.then(function(){a.public_armies=d.data.ArmyLists,a.armies=a.public_armies.slice(0,a.numPerPage),a.armyTotal=a.public_armies.length,a.pagecount=Math.floor(a.armyTotal/a.numPerPage)}),a.votes=function(b,c){e.votingFront(a,b,c)},a.prevPage=function(){a.currentPage>0&&Pagination.set(a,a.currentPage-1)},a.nextPage=function(){a.currentPage<a.public_armies.length-1&&Pagination.set(a,a.currentPage+1)},a.setPage=function(b){Pagination.set(a,b)},a.startPage=function(){Pagination.set(a,0)},a.lastPage=function(){Pagination.set(a,a.pagecount-1)}}]),myApp.controller("SetupCtrl",["$scope","$rootScope","$routeParams","$location","list","squadbuilder",function(a,b,c,d,e,f){a.user_id=$sid,a.squad_list=[],b.logged_in||(window.location.href="#/"),a.routeParams=c,a.armycost=0;var g=e.getAsync("GET","/types.json",{});a.unit_types={},g.then(function(){a.unit_types=e.data.Types});var h=e.getAsync("GET","/view_army/"+a.routeParams.id+".json",{});a.army={},h.then(function(){a.army=e.data.ArmyLists;var b=e.getSecure("GET","/squads_units/"+a.army.armies_id,{});a.squads={},b.then(function(b){a.squads=b.Squads,a.currentSquad()})}),a.currentDraggedSquad=null,a.getSquad=function(){a.currentDraggedSquad=this.squad},a.dropPos=0,a.startPos=0,a.knownId=null,a.currentSquad=function(){f.generate(a)},a.squadBuilder=function(b,c,d){f.build(a,b,c,d)},a.submit_army=function(){var b=e.getAsync("POST","/save_units/"+a.routeParams.id+".json",SquadList.submitSquad());return b.then(function(b){200==b.code&&d.path("view/"+a.routeParams.id)}),!1},a.squadPositionsOnSort=function(a,b,c){SquadList.squadPositionsOnSort(a,b,c)},a.removeSquad=function(b,c){SquadList.removeSquad(b,c),a.armycost=SquadList.getTotal()},a.addSquad=function(b,c){UnitCount.add(b,c),a.armycost=SquadList.getTotal()},a.subSquad=function(b,c){UnitCount.sub(b,c),a.armycost=SquadList.getTotal()},a.addWargear=function(b,c){Wargear.add(b,c,this.selectedItem),a.armycost=SquadList.getTotal()},a.subWargear=function(b,c,d,e){Wargear.remove(b,c,d,e),a.armycost=SquadList.getTotal()}}]),myApp.controller("UserCtrl",["$scope","$routeParams","$rootScope","$location","list","displayErrors",function(a,b,c,d,e,f){if(a.formMessage="",(("/user/login"===d.path()||"/user/register"===d.path())&&c.logged_in||"/user/profile"===d.path()&&!c.logged_in)&&(window.location.href="#/"),a.login=function(){if(a.UserLoginForm.$invalid)a.formMessage="Form contains errors";else{a.formMessage="";var b=e.getAsync("POST","/user/login.json",{data:{Users:{email:this.email,password:this.password}}});b.then(function(b){200===b.code?(c.user_id=parseInt(b.data.user_id,0),c.user_name=b.data.username,c.logged_in=!0,d.path("#/")):a.formMessage=f.formErrors(b.errors)})}},a.register=function(){if(a.UserRegisterForm.$invalid)a.formMessage="Form contains errors";else{a.formMessage="";var b=e.getAsync("POST","/user/register.json",{data:{Users:{username:this.username,email:this.email,password:this.password,confirm_password:this.confirm_password,slug:""}}});b.then(function(b){200===b.code?window.location.href="#/user/confirm_register":a.formMessage=f.formErrors(b.errors)})}},a.lostpassword=function(){if(a.UserLostPasswordForm.$invalid)a.formMessage="Form contains errors";else{a.formMessage="";var b=e.getAsync("POST","/user/lost_password.json",{data:{Users:{email:this.email}}});b.then(function(b){200===b.code?window.location.href="#/user/lost_password_update":a.formMessage=f.formErrors(b.errors)})}},"/user/profile"===d.path()){a.formMessage="",a.formSuccessMessage="";var g=e.getAsync("GET","/user/profile.json",{});g.then(function(b){a.email=b.Users.email})}a.profile=function(){if(a.UserProfileForm.$invalid)a.formMessage="Form contains errors";else{a.formMessage="";var b={};b=null!==this.password&&void 0!==this.password&&""!==this.password?{email:this.email,password:this.password,confirm_password:this.confirm_password}:{email:this.email};var c=e.getAsync("POST","/user/profile.json",{data:{Users:b}});c.then(function(b){200===b.code?a.formSuccessMessage="Success: Your profile has been updated":a.formMessage=f.formErrors(b.errors)})}}}]),myApp.controller("UserManageCtrl",["$scope","$rootScope","$location",function(a,b){b.user_id=$sid,b.user_name=$suser,b.logged_in=isNaN(b.user_id)||"Guest"==b.user_name?!1:!0}]),myApp.controller("ViewCtrl",["$scope","$routeParams","$location","list","vote","squadbuilder",function(a,b,c,d,e,f){a.user_id=$sid,a.routeParams=b,console.log("View",a.routeParams.id);var g=d.getAsync("GET","/types.json",{});a.unit_types={},g.then(function(){a.unit_types=d.data.Types});var h=d.getAsync("GET","/view_army/"+a.routeParams.id+".json",{});a.army={},h.then(function(){a.army=d.data.ArmyLists;var b=d.getSecure("GET","/squads_units/"+a.army.armies_id,{});a.squads={},b.then(function(b){a.squads=b.Squads,a.currentSquad()})}),a.armycost=0,a.currentSquad=function(){f.generate(a)},a.votes=function(b,c){e.votingView(a,b,c),$(".active.up").removeClass("active"),$(".active.down").removeClass("active")},a.dateMomment=function(a){return moment(a,"YYYY-MM-DD HH:mm:ss").fromNow()}}]);var Pagination=function(){return{set:function(a,b){a.currentPage=b;var c=a.numPerPage*a.currentPage,d=a.numPerPage*a.currentPage+a.numPerPage;a.armies=a.public_armies.slice(c,d)}}}(),UnitCount=function(){return{add:function(a,b){count=b.getAttr("count")+1,b.setAttr("count",count),a.addTotal(b.getAttr("pts"))},sub:function(a,b){count=b.getAttr("count")-1,b.setAttr("count",count),a.subTotal(b.getAttr("pts"))}}}(),Wargear=function(){return{add:function(a,b,c){if(b.setArrayAttr("Equiped",c),null!==c.UnitUpgrades&&void 0!==c.UnitUpgrades)switch(c.UnitUpgrades.operation){case"+":b.setUnitAttr(c.UnitUpgrades.effected_column,b.getUnitAttr(c.UnitUpgrades.effected_column)+c.UnitUpgrades.factor);break;case"*":b.setUnitAttr(c.UnitUpgrades.effected_column,b.getUnitAttr(c.UnitUpgrades.effected_column)*c.UnitUpgrades.factor);break;case"=":}a.addTotal(c.pts)},remove:function(a,b,c,d){if(b.getAttr("Equiped").splice(d,1),null!==c.UnitUpgrades&&void 0!==c.UnitUpgrades)switch(c.UnitUpgrades.operation){case"+":b.setUnitAttr(c.UnitUpgrades.effected_column,b.getUnitAttr(c.UnitUpgrades.effected_column)-c.UnitUpgrades.factor);break;case"*":b.setUnitAttr(c.UnitUpgrades.effected_column,b.getUnitAttr(c.UnitUpgrades.effected_column)/c.UnitUpgrades.factor);break;case"=":}a.subTotal(c.pts)}}}();myApp.directive("ngLoadscreen",[function(){return{priority:100,restrict:"A",link:function(a,b){Loader.init(b)}}}]),myApp.directive("ngClickAdd",[function(){return{restrict:"A",link:function(a,b){b.bind("click",function(b){b.stopImmediatePropagation(),b.preventDefault(),a.getSquad();var c=$(this).attr("class");a.squadBuilder(c,$(this),-1)})}}}]),myApp.directive("ngConfirmClick",[function(){return{priority:100,restrict:"A",link:function(a,b,c){b.bind("click",function(b){var d=c.ngConfirmClick,e=c.confirmedClick;d&&confirm(d)&&(b.stopImmediatePropagation(),b.preventDefault(),a.$parent.submit_delete(e))})}}}]),myApp.directive("ngDrag",[function(){return{restrict:"A",link:function(a,b,c){c.$observe("ngAccept",function(c){b.draggable({cursor:"move",connectToSortable:c,helper:"clone",revert:"invalid",stop:function(){a.getSquad()}})})}}}]).directive("ngDrop",[function(){return{restrict:"A",link:function(a,b){var c=-1;b.sortable({revert:!0,placeholder:"a-drop-highlight",start:function(b,c){a.startPos=c.item.index(),a.knownId=c.item.attr("id")},update:function(b,d){a.dropPos=d.item.index(),c=d.item.index(),void 0!==d.item.attr("id")&&a.squadPositionsOnSort(d.item.attr("id"),d.item.index(),a.startPos)},stop:function(b,d){if(!d.item.data("tag")&&!d.item.data("handle")&&void 0===d.item.attr("id")){d.item.data("tag",!0);var e=d.item.attr("class").split(" ");a.squadBuilder(e[1],d.item,c)}}}).disableSelection()}}}]),myApp.directive("ngToggle",[function(){return{priority:100,restrict:"A",link:function(a,b){b.bind("click",function(){0===$("html#toggle").length?$("html").attr("id","toggle"):$("html#toggle").removeAttr("id")})}}}]),myApp.factory("displayErrors",[function(){return{formErrors:function(a){var b="";if(void 0===a.message)for(var c=0,d=a.length;d>c;c++)0!==c&&(b+="<br />"),b+="<strong>"+a[c][0]+"</strong>: "+a[c][1];else b="<strong>Problem</strong>: Sorry there is a problem creating your account, please try back later.";return b}}}]),myApp.filter("truncate",function(){return function(a,b,c){return isNaN(b)&&(b=10),void 0===c&&(c="..."),a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c}}).filter("joinBy",function(){return function(a,b){return(a||[]).join(b||", ")}}).filter("active",function(){return function(a,b){return b!=a||"up"!=a&&"down"!=a?void 0:" active"}}).filter("hidden",function(){return function(a,b){return b===!0?"True":"False"}}).filter("groups",function(){return function(a){return a.toLowerCase().replace(" ","")}}).filter("date",function(){return function(a){return moment(a,"YYYY-MM-DD HH:mm:ss").fromNow()}}).filter("range",function(){return function(a,b,c){b--;var d=3,e=c-d,f=c+d;0>e&&(f-=e,e=0),f>=b&&(e-=f-b,0>e&&(e=0),f=b);for(var g=e,h=f;h>=g;g++)a.push(g);return a}}),myApp.config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)}}]),myApp.factory("list",["$http","$q",function(a,b){var c={};return c.getAsync=function(d,e,f){c.data={};var g=b.defer();return"POST"==d||"PUT"==d?a({method:d,url:e,data:f,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a){console.log(d,e,a),c.data=a,g.resolve(c.data)}).error(function(a){console.log("Service list: "+e+" error"),c.data=a,g.resolve(c.data)}):"DELETE"==d?a({method:d,url:e,data:f}).success(function(a){console.log(d,e,a),c.data=a,g.resolve(c.data)}).error(function(){console.log("Service list: "+e+" error")}):a({method:d,url:e,params:f}).success(function(a){console.log(d,e,a),c.data=a.data,g.resolve(c.data)}).error(function(){console.log("Service list: "+e+" error")}),g.promise},c.getSecure=function(a,c,d){var e=this,f=b.defer(),g=this.getAsync("GET","/access.json",{});return g.then(function(b){c=c+"/"+b+".json";var g=e.getAsync(a,c,d);g.then(function(a){e.data=a,f.resolve(e.data)})}),f.promise},c.outputError=function(a){var b="<ul>";for(var c in a)b+="<li>"+a[c]+"</li>";return b+="</ul>"},c}]),myApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"pages/partials/index",controller:"DisplayCtrl"}).when("/add",{templateUrl:"pages/partials/add_army",controller:"AddCtrl"}).when("/view/:id",{templateUrl:"pages/partials/view_army",controller:"ViewCtrl"}).when("/edit/:id",{templateUrl:"pages/partials/edit_army",controller:"EditCtrl"}).when("/setup/:id",{templateUrl:"pages/partials/setup_army",controller:"SetupCtrl"}).when("/lists",{templateUrl:"pages/partials/list",controller:"ListCtrl"}).when("/my_lists",{templateUrl:"pages/partials/my_list",controller:"ListCtrl"}).when("/user/login",{templateUrl:"pages/partials/user_login",controller:"UserCtrl"}).when("/user/register",{templateUrl:"pages/partials/user_register",controller:"UserCtrl"}).when("/user/confirm_register",{templateUrl:"pages/partials/user_register_post",controller:"UserCtrl"}).when("/user/reset_password",{templateUrl:"pages/partials/user_reset_password",controller:"UserCtrl"}).when("/user/lost_password_update",{templateUrl:"pages/partials/user_lost_password_update",controller:"UserCtrl"}).when("/user/profile",{templateUrl:"pages/partials/user_profile",controller:"UserCtrl"}).otherwise({redirectTo:"/"})}]),myApp.factory("squadbuilder",[function(){return{generate:function(a){SquadList.cleanSquad();var b=a.army.ArmySquads,c=a.squads;if(void 0!==b)for(var d=0,e=b.length;e>d;d++)for(var f=0,g=c.length;g>f;f++)if(a.squads[f].id==b[d].squads_id){var h=0,i=[],j=new Squad,k=c[f].SquadUnits;for(var l in k){var m=b[d].ArmyUnits[l].count;h+=parseInt(k[l].pts,0)*parseInt(m,0),0!==k[l].Units.front_armour&&j.setArmour(!0);var n=new Unit(k[l]);if(n.setAttr("count",m),i.push(n),j.buildCharacteristics(k[l].UnitCharacteristics),j.buildWargears(k[l].Wargears),void 0!==b[d].ArmyUnits[l].ArmyWargears)for(var o=b[d].ArmyUnits[l].ArmyWargears,p=0,q=o.length;q>p;p++){var r=k[l].Groups;if(void 0!==r)for(var s=0,t=r.length;t>s;s++)for(var u=0,v=r[s].Wargears.length;v>u;u++)if(o[p].wargears_id===r[s].Wargears[u].id){Wargear.add(j,n,r[s].Wargears[u]);break}}}j.setId(d),j.setPosition(parseInt(b[d].position,0)),j.setSquadId(c[f].id),j.Group=c[f].type_name,j.addTotal(h),j.setUnits(i),j.setArmyList(a.routeParams.id),j.setName(c[f].name),SquadList.setSquad(j);break}a.squad_list=SquadList.getSquad(),a.armycost=SquadList.getTotal(),SquadList.orderSquads()},build:function(a,b,c,d){var e=0,f=[],g=new Squad;-1===d?d=SquadList.getSquad().length:c.remove();for(var h in a.currentDraggedSquad.SquadUnits)e+=parseInt(a.currentDraggedSquad.SquadUnits[h].pts,0)*parseInt(a.currentDraggedSquad.SquadUnits[h].min_count,0),f.push(new Unit(a.currentDraggedSquad.SquadUnits[h])),0!==a.currentDraggedSquad.SquadUnits[h].Units.front_armour&&g.setArmour(!0),g.buildCharacteristics(a.currentDraggedSquad.SquadUnits[h].UnitCharacteristics),g.buildWargears(a.currentDraggedSquad.SquadUnits[h].Wargears);g.setId(SquadList.getSquad().length),g.setSquadId(a.currentDraggedSquad.id),g.setPosition(d),g.setGroup(b),g.addTotal(e),g.setUnits(f),g.setArmyList(a.routeParams.id),g.setName(a.currentDraggedSquad.name),SquadList.squadPositionsOnAction(d,!0),a.$apply(function(){SquadList.setSquad(g),a.squad_list=SquadList.getSquad(),a.armycost=SquadList.getTotal(),SquadList.orderSquads()})}}}]),myApp.factory("vote",["list",function(a){return{votingFront:function(b,c,d){var e=a.getAsync("PUT","/vote/"+c+"/"+d+".json",{});e.then(function(){if(200==a.data.code){var c=a.getAsync("GET","/armies_all.json",{});b.my_armies={},b.all_armies={},b.top_armies={},c.then(function(){0!==b.user_id&&(b.my_armies=a.data.private.ArmyLists,b.my_armies_count=a.data.private.count),b.all_armies=a.data.public.ArmyLists,b.all_armies_count=a.data.public.count,b.top_armies=a.data.top.ArmyLists})}else 403==a.data.code&&(window.location.href="#/user/login")})},votingView:function(b,c,d){var e=a.getAsync("PUT","/vote/"+c+"/"+d+".json",{});e.then(function(){if(200==a.data.code){var c=a.getAsync("GET","/view_army/"+b.routeParams.id+".json",{});b.army={},c.then(function(){b.army=a.data.ArmyLists})}else 403==a.data.code&&(window.location.href="#/user/login")})}}}]);
//# sourceMappingURL=build.min.js.map